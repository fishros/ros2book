

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2.3.1 Writing Nodes in a Package &mdash; Hands-On ROS 2 for Robotics Programming v1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5cb08e4e"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="2.3.2 Package Structure Analysis" href="chapter2_3_2.html" />
    <link rel="prev" title="2.3 Organizing C++ Nodes Using Packages" href="chapter2_3.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Hands-On ROS 2 for Robotics Programming
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../Introduce.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Introduce.html#course-structure-content-overview">Course Structure &amp; Content Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../chapter1/index.html">Chapter 1: Get-Started —— Bringing Your First Robot to Life</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Chapter 2. Getting Started with ROS 2 Basics—Starting with the First Node</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../chapter2.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter2_1/chapter2_1.html">2.1 Writing Your First Node</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter2_2/chapter2_2.html">2.2 Organizing Python Nodes Using Packages</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="chapter2_3.html">2.3 Organizing C++ Nodes Using Packages</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">2.3.1 Writing Nodes in a Package</a></li>
<li class="toctree-l3"><a class="reference internal" href="chapter2_3_2.html">2.3.2 Package Structure Analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../chapter2_4/chapter2_4.html">2.4 Best Practices for Multi-Package Workspaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter2_5/chapter2_5.html">2.5 ROS 2 Basics: Programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter2_6/chapter2_6.html">2.6 Chapter Summary and Comments</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../chapter3/index.html">Chapter 3. Subscribing and Publishing—Exploring Topic Communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Hands-On ROS 2 for Robotics Programming</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Chapter 2. Getting Started with ROS 2 Basics—Starting with the First Node</a></li>
          <li class="breadcrumb-item"><a href="chapter2_3.html">2.3 Organizing C++ Nodes Using Packages</a></li>
      <li class="breadcrumb-item active">2.3.1 Writing Nodes in a Package</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/chapter2/chapter2_3/chapter2_3_1.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="writing-nodes-in-a-package">
<h1>2.3.1 Writing Nodes in a Package<a class="headerlink" href="#writing-nodes-in-a-package" title="Link to this heading"></a></h1>
<p>Open the integrated terminal in VS Code, navigate to the <cite>chapt2</cite> directory, and enter the command shown in Listing 2-21.</p>
<p><strong>Listing 2-21: Creating a C++ Package</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ros2<span class="w"> </span>pkg<span class="w"> </span>create<span class="w"> </span>demo_cpp_pkg<span class="w"> </span>--build-type<span class="w"> </span>ament_cmake<span class="w"> </span>--license<span class="w"> </span>Apache-2.0
---
going<span class="w"> </span>to<span class="w"> </span>create<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>package
package<span class="w"> </span>name:<span class="w"> </span>demo_cpp_pkg
destination<span class="w"> </span>directory:<span class="w"> </span>/home/fishros/chapt2
package<span class="w"> </span>format:<span class="w"> </span><span class="m">3</span>
version:<span class="w"> </span><span class="m">0</span>.0.0
description:<span class="w"> </span>TODO:<span class="w"> </span>Package<span class="w"> </span>description
maintainer:<span class="w"> </span><span class="o">[</span><span class="s1">&#39;fishros &lt;fishros@todo.todo&gt;&#39;</span><span class="o">]</span>
licenses:<span class="w"> </span><span class="o">[</span><span class="s1">&#39;Apache-2.0&#39;</span><span class="o">]</span>
build<span class="w"> </span>type:<span class="w"> </span>ament_cmake
dependencies:<span class="w"> </span><span class="o">[]</span>
creating<span class="w"> </span>folder<span class="w"> </span>./demo_cpp_pkg
creating<span class="w"> </span>./demo_cpp_pkg/package.xml
creating<span class="w"> </span><span class="nb">source</span><span class="w"> </span>and<span class="w"> </span>include<span class="w"> </span>folder
creating<span class="w"> </span>folder<span class="w"> </span>./demo_cpp_pkg/src
creating<span class="w"> </span>folder<span class="w"> </span>./demo_cpp_pkg/include/demo_cpp_pkg
creating<span class="w"> </span>./demo_cpp_pkg/CMakeLists.txt
</pre></div>
</div>
<p>The <cite>ros2 pkg create</cite> command is used to create a package. Here, <cite>demo_cpp_pkg</cite> is the name of the package, <cite>–build-type ament_cmake</cite> specifies that the package’s build type is <cite>ament_cmake</cite>, and <cite>–license Apache-2.0</cite> declares the open-source license for the package. From the log, it’s clear that this command creates a <cite>demo_cpp_pkg</cite> folder in the current directory and generates some default files and folders within it. Expand this folder in the VS Code Explorer on the left, as shown in Figure 2-11.</p>
<figure class="align-center" id="id1">
<img alt="C++ Package Directory Structure" src="../../_images/figure2-11.png" />
<figcaption>
<p><span class="caption-text">Figure 2-11 C++ Package Directory Structure</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>In the next section, we’ll analyze the structure of this package. For now, you only need to know that you write nodes in the <cite>src</cite> directory. Add <cite>cpp_node.cpp</cite> under <cite>demo_cpp_pkg/src</cite>, and then enter the code shown in Listing 2-22 in the file.</p>
<p><strong>Listing 2-22: A Simple C++ Node</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;rclcpp/rclcpp.hpp&quot;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">);</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Node</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;cpp_node&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Hello C++ Node!&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">spin</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
<span class="w">    </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">shutdown</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You’re not mistaken—Listing 2-22 is the same code from Section 1.4.4, which you can use directly without adding extra code. After writing the code, you’ll also need to register the node and add dependencies. Edit <cite>CMakeLists.txt</cite>, and the final additions and their locations are shown in Listing 2-23.</p>
<p><strong>Listing 2-23: chapt2/demo_cpp_pkg/CMakeLists.txt</strong></p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.8</span><span class="p">)</span>
<span class="err">…</span>
<span class="nb">find_package</span><span class="p">(</span><span class="s">ament_cmake</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>
<span class="c"># Uncomment the following section in order to fill in</span>
<span class="c"># further dependencies manually.</span>
<span class="c"># 1. Find rclcpp headers and libraries</span>
<span class="nb">find_package</span><span class="p">(</span><span class="s">rclcpp</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>
<span class="c"># 2. Add executable cpp_node</span>
<span class="nb">add_executable</span><span class="p">(</span><span class="s">cpp_node</span><span class="w"> </span><span class="s">src/cpp_node.cpp</span><span class="p">)</span>
<span class="c"># 3. Add dependencies for cpp_node</span>
<span class="nb">ament_target_dependencies</span><span class="p">(</span><span class="s">cpp_node</span><span class="w"> </span><span class="s">rclcpp</span><span class="p">)</span>
<span class="c"># 4. Copy cpp_node to the install directory</span>
<span class="nb">install</span><span class="p">(</span><span class="s">TARGETS</span>
<span class="s">cpp_node</span>
<span class="s">DESTINATION</span><span class="w"> </span><span class="s">lib/</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span>
<span class="p">)</span>
<span class="err">…</span>
<span class="nb">ament_package</span><span class="p">()</span>
</pre></div>
</div>
<p>In Listing 2-23, after adding <cite>find_package</cite> and <cite>add_executable</cite> to find dependencies and add the executable, we use the <cite>ament_target_dependencies</cite> directive provided by <cite>ament_cmake</cite> to add dependencies. Finally, the <cite>install</cite> directive is added to copy the compiled executable to the <cite>install/demo_cpp_pkg/lib/demo_cpp_pkg</cite> directory, so that <cite>ros2 run</cite> can find the node.</p>
<p>When creating the C++ package, the selected build type is <cite>ament_cmake</cite>, which is essentially a superset of CMake. <cite>ament_cmake</cite> adds some more convenient directives on top of CMake’s instruction set. In Listing 2-23, you can see the <cite>find_package(ament_cmake REQUIRED)</cite> directive, which is automatically added when creating an <cite>ament_cmake</cite> package. This allows you to use <cite>ament</cite>-related directives, such as <cite>ament_target_dependencies</cite> and <cite>ament_package</cite>.</p>
<p>The last line in Listing 2-23 is <cite>ament_package()</cite>. This directive collects information from <cite>CMakeLists.txt</cite>, generates indexes, and performs related configurations. Therefore, this directive must be called at the end of <cite>CMakeLists.txt</cite> for every <cite>ament_cmake</cite>-type package.</p>
<p>Before building the package, you also need to add a dependency declaration for <cite>rclcpp</cite> in the manifest file <cite>package.xml</cite>. The complete declaration is shown in Listing 2-24.</p>
<p><strong>Listing 2-24: chapt2/demo_cpp_pkg/package.xml</strong></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
…
<span class="w">  </span><span class="nt">&lt;license&gt;</span>Apache-2.0<span class="nt">&lt;/license&gt;</span>
<span class="w">  </span><span class="nt">&lt;depend&gt;</span>rclcpp<span class="nt">&lt;/depend&gt;</span>
<span class="w">  </span><span class="nt">&lt;test_depend&gt;</span>ament_copyright<span class="nt">&lt;/test_depend&gt;</span>
…
<span class="nt">&lt;/package&gt;</span>
</pre></div>
</div>
<p>The <cite>&lt;depend&gt;rclcpp&lt;/depend&gt;</cite> line declares that the current package depends on the <cite>rclcpp</cite> library. After completing these steps, you can build the package using the command in Listing 2-25.</p>
<p><strong>Listing 2-25: Building the Package</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>colcon<span class="w"> </span>build
---
Starting<span class="w"> </span>&gt;&gt;&gt;<span class="w"> </span>demo_cpp_pkg
Starting<span class="w"> </span>&gt;&gt;&gt;<span class="w"> </span>demo_python_pkg
Finished<span class="w"> </span><span class="o">&lt;&lt;&lt;</span><span class="w"> </span>demo_cpp_pkg<span class="w"> </span><span class="o">[</span><span class="m">0</span>.41s<span class="o">]</span>
Finished<span class="w"> </span><span class="o">&lt;&lt;&lt;</span><span class="w"> </span>demo_python_pkg<span class="w"> </span><span class="o">[</span><span class="m">0</span>.73s<span class="o">]</span>

Summary:<span class="w"> </span><span class="m">2</span><span class="w"> </span>packages<span class="w"> </span>finished<span class="w"> </span><span class="o">[</span><span class="m">0</span>.85s<span class="o">]</span>
</pre></div>
</div>
<p>In Listing 2-25, <cite>colcon</cite> is the tool used in ROS 2 to build packages. Using <cite>colcon build</cite> here will build all packages in the current and subdirectories. If the <cite>build</cite>, <cite>install</cite>, and <cite>log</cite> directories do not exist in the current directory, they will be automatically created, and the build intermediate files, results, and logs will be placed in the corresponding directories. After the build is complete, you can see the <cite>cpp_node</cite> executable in the <cite>chapt2/install/demo_cpp_pkg/lib/demo_cpp_pkg/</cite> directory. Next, you can run the executable by entering the two commands in Listing 2-26.</p>
<p><strong>Listing 2-26: Running the Node</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">source</span><span class="w"> </span>install/setup.bash
$<span class="w"> </span>ros2<span class="w"> </span>run<span class="w"> </span>demo_cpp_pkg<span class="w"> </span>cpp_node
---
<span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="m">1680684100</span>.228612032<span class="o">]</span><span class="w"> </span><span class="o">[</span>cpp_node<span class="o">]</span>:<span class="w"> </span>Hello<span class="w"> </span>C++<span class="w"> </span>Node!
</pre></div>
</div>
<p>In Listing 2-26, the <cite>source</cite> command serves the same purpose as in the Python example in Section 2.2.1—it allows ROS 2 to find <cite>demo_cpp_pkg</cite> and its nodes. After running the command, you’ll see that the node has successfully started. At this point, we’ve completed writing a node in a C++ package. However, you should know that <cite>colcon build</cite> essentially calls <cite>cmake</cite> and <cite>make</cite> to compile the code.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="chapter2_3.html" class="btn btn-neutral float-left" title="2.3 Organizing C++ Nodes Using Packages" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="chapter2_3_2.html" class="btn btn-neutral float-right" title="2.3.2 Package Structure Analysis" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, fishros.org.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>