

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>3.3.1 Publishing Velocity to Make the Turtle Draw a Circle &mdash; Hands-On ROS 2 for Robotics Programming v1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5cb08e4e"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="3.3.2 Closed-loop Control Using Pose Subscription" href="chapter3_3_2.html" />
    <link rel="prev" title="3.3 Topic Publishing and Subscribing in C++" href="chapter3_3.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Hands-On ROS 2 for Robotics Programming
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../Introduce.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Introduce.html#course-structure-content-overview">Course Structure &amp; Content Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../chapter1/index.html">Chapter 1: Get-Started —— Bringing Your First Robot to Life</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../chapter2/index.html">Chapter 2. Getting Started with ROS 2 Basics—Starting with the First Node</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Chapter 3. Subscribing and Publishing—Exploring Topic Communication</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../chapter3.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter3_1/chapter3_1.html">3.1 Introduction to Topic Communication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter3_2/chapter3_2.html">3.2 Python Topic Subscription and Publishing</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="chapter3_3.html">3.3 Topic Publishing and Subscribing in C++</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">3.3.1 Publishing Velocity to Make the Turtle Draw a Circle</a></li>
<li class="toctree-l3"><a class="reference internal" href="chapter3_3_2.html">3.3.2 Closed-loop Control Using Pose Subscription</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../chapter3_4/chapter3_4.html">3.4 Best Practices for Topic Communication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter3_5/chapter3_5.html">3.5 ROS 2 Basics: Introduction to Git</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter3_6/chapter3_6.html">3.6 Chapter Summary and Review</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Hands-On ROS 2 for Robotics Programming</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Chapter 3. Subscribing and Publishing—Exploring Topic Communication</a></li>
          <li class="breadcrumb-item"><a href="chapter3_3.html">3.3 Topic Publishing and Subscribing in C++</a></li>
      <li class="breadcrumb-item active">3.3.1 Publishing Velocity to Make the Turtle Draw a Circle</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/chapter3/chapter3_3/chapter3_3_1.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="publishing-velocity-to-make-the-turtle-draw-a-circle">
<h1>3.3.1 Publishing Velocity to Make the Turtle Draw a Circle<a class="headerlink" href="#publishing-velocity-to-make-the-turtle-draw-a-circle" title="Link to this heading"></a></h1>
<p>After the turtle simulator node starts running, it automatically generates a turtle. The simulator node subscribes to the topic named <cite>/turtle1/cmd_vel</cite> to receive control commands, and the message type of this topic is <cite>geometry_msgs/msg/Twist</cite>. While subscribing, the node also publishes its current position, with the message type of this topic being <cite>turtlesim/msg/Pose</cite>. To enable subscribing to and publishing the corresponding topics in the code, dependencies on <cite>geometry_msgs</cite> and <cite>turtlesim</cite> must be added when creating the package. Open the terminal, navigate to the directory <cite>chapt3/topic_ws/src</cite>, and enter the command in Code Listing 3-17 to create the <cite>demo_cpp_topic</cite> package.</p>
<p><strong>Listing 3-17 Create the `demo_cpp_topic` package and add the dependencies</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ros2<span class="w"> </span>pkg<span class="w"> </span>create<span class="w"> </span>demo_cpp_topic<span class="w"> </span>--build-type<span class="w"> </span>ament_cmake<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--dependencies<span class="w"> </span>rclcpp<span class="w"> </span>geometry_msgs<span class="w"> </span>turtlesim<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--license<span class="w"> </span>Apache-2.0
---
going<span class="w"> </span>to<span class="w"> </span>create<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>package
package<span class="w"> </span>name:<span class="w"> </span>demo_cpp_topic
destination<span class="w"> </span>directory:<span class="w"> </span>/home/fishros/chapt3/topic_ws/src
package<span class="w"> </span>format:<span class="w"> </span><span class="m">3</span>
version:<span class="w"> </span><span class="m">0</span>.0.0
description:<span class="w"> </span>TODO:<span class="w"> </span>Package<span class="w"> </span>description
maintainer:<span class="w"> </span><span class="o">[</span><span class="s1">&#39;fishros &lt;fishros@todo.todo&gt;&#39;</span><span class="o">]</span>
licenses:<span class="w"> </span><span class="o">[</span><span class="s1">&#39;Apache-2.0&#39;</span><span class="o">]</span>
build<span class="w"> </span>type:<span class="w"> </span>ament_cmake
dependencies:<span class="w"> </span><span class="o">[</span><span class="s1">&#39;rclcpp&#39;</span>,<span class="w"> </span><span class="s1">&#39;geometry_msgs&#39;</span>,<span class="w"> </span><span class="s1">&#39;turtlesim&#39;</span><span class="o">]</span>
...
</pre></div>
</div>
<p>After creating the feature pack, create a <cite>turtle_circle.cpp</cite> file under <cite>src/demo_cpp_topic/src</cite>, and then write the code as shown in Listing 3-18 in the file.</p>
<p><strong>Listing 3-18 src/demo_cpp_topic/src/turtle_circle.cpp</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;rclcpp/rclcpp.hpp&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;geometry_msgs/msg/twist.hpp&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;chrono&gt;</span>
<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="o">::</span><span class="nn">chrono_literals</span><span class="p">;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TurtleCircle</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Node</span>
<span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">  </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">TimerBase</span><span class="o">::</span><span class="n">SharedPtr</span><span class="w"> </span><span class="n">timer_</span><span class="p">;</span>
<span class="w">  </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Publisher</span><span class="o">&lt;</span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Twist</span><span class="o">&gt;::</span><span class="n">SharedPtr</span><span class="w"> </span><span class="n">publisher_</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
<span class="w">  </span><span class="k">explicit</span><span class="w"> </span><span class="n">TurtleCircle</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">node_name</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Node</span><span class="p">(</span><span class="n">node_name</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">publisher_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">create_publisher</span><span class="o">&lt;</span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Twist</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;/turtle1/cmd_vel&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
<span class="w">    </span><span class="n">timer_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">create_wall_timer</span><span class="p">(</span><span class="mi">1000</span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">TurtleCircle</span><span class="o">::</span><span class="n">timer_callback</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">));</span>
<span class="w">  </span><span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">timer_callback</span><span class="p">()</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Twist</span><span class="p">();</span>
<span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">;</span>
<span class="w">    </span><span class="n">publisher_</span><span class="o">-&gt;</span><span class="n">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">);</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">TurtleCircle</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;turtle_square&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">spin</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
<span class="w">  </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">shutdown</span><span class="p">();</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In Code Listing 3-18, the ROS 2 client library <cite>rclcpp</cite> and the message interface <cite>geometry_msgs/msg/twist.hpp</cite> are first included. Then, the time library header is introduced, and the <cite>using</cite> declaration is used to enable time unit literals. Literals are a new feature in C++14, allowing direct use of numbers followed by <cite>s</cite> or <cite>ms</cite> to represent time, making the code more intuitive.</p>
<p>After importing the headers, a <cite>TurtleCircle</cite> class is defined, with two attributes added: a shared pointer to a timer (<cite>timer_</cite>) and a shared pointer to a topic publisher (<cite>publisher_</cite>). These attributes are then initialized in the constructor.</p>
<p>The <cite>this-&gt;create_publisher</cite> method is inherited from the parent class and is used to initialize the publisher. The <cite>&lt;&gt;</cite> syntax is a C++ template, and the enclosed <cite>geometry_msgs::msg::Twist</cite> specifies the topic’s interface type. The first parameter of this method is the topic name, which must match the topic name subscribed to by the turtle for communication to work. The second parameter is <cite>10</cite>, which, as in Python, relates to ROS 2’s Quality of Service (QoS) and is explained in detail in Chapter 10. Here, <cite>10</cite> represents the history queue length.</p>
<p>The <cite>this-&gt;create_wall_timer</cite> method also comes from the parent node and is used to initialize the timer. The first parameter is the call interval, set here to <cite>1000ms</cite>, meaning it will be triggered every second. The second parameter is the callback function, where the member method <cite>timer_callback</cite> is converted into a directly callable callback function using <cite>std::bind</cite>.</p>
<p>Inside the <cite>timer_callback</cite> method, a message object of type <cite>geometry_msgs::msg::Twist</cite> is first created. The linear velocity <cite>x</cite> in the forward direction is set to 1 meter per second, and the rotational angular velocity around the z-axis is set to 0.5 radians per second. At this point, the turtle’s turning radius should be 1 divided by 0.5, equaling 2 meters.</p>
<p>Finally, in <cite>CMakeLists.txt</cite>, the <cite>turtle_circle</cite> node is added along with its dependencies. The main instructions are as shown in Code Listing 3-19.</p>
<p><strong>Listing 3-19 src/demo_cpp_topic/CMakeLists.txt</strong></p>
<div class="highlight-txt notranslate"><div class="highlight"><pre><span></span>add_executable(turtle_circle src/turtle_circle.cpp)
ament_target_dependencies(turtle_circle rclcpp geometry_msgs)

install(TARGETS
  turtle_circle
  DESTINATION lib/${PROJECT_NAME}
)
ament_package()
</pre></div>
</div>
<p>Save and build the demo_cpp_topic package, run the turtle simulator, and then run the turtle_circle node. Observe the turtle simulator, and the result should be as shown in Figure 3-3.</p>
<figure class="align-center" id="id1">
<img alt="The turtle draws a circular trajectory." src="../../_images/figure3-3.png" />
<figcaption>
<p><span class="caption-text">Figure 3-3 The turtle draws a circular trajectory.</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="chapter3_3.html" class="btn btn-neutral float-left" title="3.3 Topic Publishing and Subscribing in C++" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="chapter3_3_2.html" class="btn btn-neutral float-right" title="3.3.2 Closed-loop Control Using Pose Subscription" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, fishros.org.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>